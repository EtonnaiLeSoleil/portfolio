<?php
/**
 * @var array|null $user
 * @var array $projects
 * @var string|null $notice
 * @var string|null $error
 */
?>
<main class="container">

  <section id="profil">
    <h2>Profil</h2>
    <div class="card">
      <p><strong>Antoine Gouet, <?= e($user['job_title'] ?? ''); ?></strong></p>
      <p class="muted"><?= nl2br(e($user['bio'] ?? '')); ?></p>
      <?php if (!empty($user['cv_url'])): ?>
        <p><a href="uploads/<?= e($user['cv_url']); ?>" target="_blank" rel="noopener">Télécharger le CV</a></p>
      <?php endif; ?>
    </div>
  </section>

  <section id="projets">
    <h2>Projets</h2>
    <div class="grid grid-2">
      <?php foreach ($projects as $p): ?>
        <article class="card">
          <?php if (!empty($p['image_url'])): ?>
            <img class="project" src="<?= e($p['image_url']); ?>" alt="<?= e($p['title']); ?>">
          <?php endif; ?>
          <h3><?= e($p['title']); ?></h3>
          <p class="muted"><?= nl2br(e($p['description'])); ?></p>
          <?php if (!empty($p['link_url'])): ?>
            <p><a href="<?= e($p['link_url']); ?>" target="_blank" rel="noopener">Voir le projet</a></p>
          <?php endif; ?>
          <p>
            <?php
              $skills = array_filter(array_map('trim', explode(',', (string) $p['skill_list'])));
              foreach ($skills as $s) {
                  echo '<span class="badge">' . e($s) . '</span>';
              }
            ?>
          </p>
        </article>
      <?php endforeach; ?>
    </div>
  </section>

  <section id="contact">
    <h2>Contact</h2>

    <?php if ($notice): ?>
      <div class="notice success"><?= e($notice); ?></div>
    <?php endif; ?>

    <?php if ($error): ?>
      <div class="notice error"><?= e($error); ?></div>
    <?php endif; ?>

    <form method="post" class="card" novalidate>
      <label for="email">Email</label>
      <input id="email" name="email" type="email" required value="<?= e($_POST['email'] ?? ''); ?>">

      <label for="subject">Sujet</label>
      <input id="subject" name="subject" type="text" required value="<?= e($_POST['subject'] ?? ''); ?>">

      <label for="message">Message</label>
      <textarea id="message" name="message" required><?= e($_POST['message'] ?? ''); ?></textarea>

      <button class="btn" type="submit">Envoyer</button>
    </form>
  </section>

</main>
